<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Web App Qu·∫£n L√Ω L·ªõp</title>
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Qu·∫£n L√Ω L·ªõp H·ªçc">
  <link rel="apple-touch-icon" href="/icon/main.png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.6.2/sql-wasm.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/localforage/1.10.0/localforage.min.js"></script>
  <script defer src="app.js"></script>
  <link rel="stylesheet" href="style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<body>
    <button id="menuToggle" class="menu-toggle">‚ò∞ Menu qu·∫£n l√Ω 
        <svg xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            width="1em"
            height="1em"
            style="vertical-align: middle; margin-left: 4px;">
            <path d="M12 15.6315L20.9679 10.8838L20.0321 9.11619L12 13.3685L3.9679 9.11619L3.03212 10.8838L12 15.6315Z"></path>
        </svg>
    </button>
    <nav class="menu-bar">
        <ul class="menu">
            <li class="has-submenu">
            <span onclick="toggleSubmenu(this)">
                <img src="icon/home.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"> L·ªõp
                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    width="1em"
                    height="1em"
                    style="vertical-align: middle; margin-left: 4px;">
                    <path d="M12 15.6315L20.9679 10.8838L20.0321 9.11619L12 13.3685L3.9679 9.11619L3.03212 10.8838L12 15.6315Z"></path>
                </svg>
            </span>
            <ul class="submenu">
                <li onclick="handleThemLop()"><img src="icon/themlop.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;">Th√™m l·ªõp</li>
                <li onclick="handleSuaLop()"><img src="icon/sualop.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;">S·ª≠a th√¥ng tin l·ªõp</li>
                <li onclick="handleXoaLop()"><img src="icon/xoalop.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;">X√≥a l·ªõp</li>
            </ul>
            </li>
            <li class="has-submenu">
            <span onclick="toggleSubmenu(this)"><img src="icon/friend.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;"> H·ªçc sinh 
                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    width="1em"
                    height="1em"
                    style="vertical-align: middle; margin-left: 4px;">
                    <path d="M12 15.6315L20.9679 10.8838L20.0321 9.11619L12 13.3685L3.9679 9.11619L3.03212 10.8838L12 15.6315Z"></path>
                </svg>
            </span>
            <ul class="submenu">
                <li onclick="handleThemHs()"><img src="icon/themhocsinh.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;">Th√™m h·ªçc sinh</li>
                <li onclick="handleSuaHs()"><img src="icon/suahocsinh.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;">S·ª≠a th√¥ng tin h·ªçc sinh</li>
                <li onclick="handleXoaHs()"><img src="icon/xoahocsinh.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;">X√≥a h·ªçc sinh</li>
            </ul>
            </li>
            <li onclick="handleSuaNgay()"><span><img src="icon/diemdanh.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;">S·ª≠a ng√†y ƒëi·ªÉm danh</span></li>
            <li><span><img src="icon/thuhocphi.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;">Thu h·ªçc ph√≠</span></li>
            <li><span><img src="icon/icon.ico" alt="Home icon" style="width: 16px; height: 16px; vertical-align: middle; margin-right: 4px;">Th√¥ng tin</span></li>
            <li class="has-submenu">
            <span onclick="toggleSubmenu(this)">Xu·∫•t d·ªØ li·ªáu 
                <svg xmlns="http://www.w3.org/2000/svg"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                    width="1em"
                    height="1em"
                    style="vertical-align: middle; margin-left: 4px;">
                    <path d="M12 15.6315L20.9679 10.8838L20.0321 9.11619L12 13.3685L3.9679 9.11619L3.03212 10.8838L12 15.6315Z"></path>
                </svg>
            </span>
            <ul class="submenu">
                <li onclick="onMenuAction('xuat-excel')">Excel</li>
                <li onclick="onMenuAction('xuat-sqlite')">SQLite</li>
                <li onclick="onMenuAction('xuat-pdf')">Pdf</li>
            </ul>
            </li>
        </ul>
    </nav>

    <div class="action-buttons">   
        <button onclick="handleThuHocPhi()">üíµ Thu h·ªçc ph√≠</button>
        <button onclick="handleDiemDanh()">üìÖ ƒêi·ªÉm danh</button>
    </div>



    <div id="fileSelect">
        <h2>üìÇ Ch·ªçn file SQLite (.db):</h2>
        <input type="file" id="dbfile" accept=".db,.sqlite">
    </div>

  <div id="tabs"></div>
  <div id="tabContents"></div>

  <!-- Form ƒëi·ªÉm danh (·∫©n ban ƒë·∫ßu) -->
<div id="diemdanhModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>üìÖ ƒêi·ªÉm danh</h3>

    <label>Ng√†y:
      <input type="date" id="dd-date" />
    </label>

    <label>L·ªõp:
      <select id="dd-class" onchange="loadStudentsForClass()"></select>
    </label>

    <label>H·ªç v√† t√™n:
      <select id="dd-student"></select>
    </label>

    <div class="modal-actions">
      <button onclick="submitDiemDanh(1)">‚úÖ C√≥</button>
      <button onclick="submitDiemDanh(0)">‚ùå Ngh·ªâ</button>
      <button onclick="closeDiemDanh()">üîô Hu·ª∑</button>
    </div>
  </div>
</div>


<!-- Form Th√™m l·ªõp -->
<div id="themLopModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>‚ûï Th√™m l·ªõp</h3>

    <label>T√™n l·ªõp:
      <input type="text" id="lop-ten" required />
    </label>

    <label>Ng√†y b·∫Øt ƒë·∫ßu:
      <input type="date" id="lop-ngay" />
    </label>

    <label>H·ªçc ph√≠ m·ªói bu·ªïi:
      <input type="number" id="lop-hocphi" />
    </label>

    <label>Th·ªùi gian h·ªçc:
      <input type="text" id="lop-thoigian" placeholder="VD: Th·ª© 2, 4, 6 - 18h30" />
    </label>

    <label>ƒê·ªãa ƒëi·ªÉm:
      <input type="text" id="lop-diadiem" />
    </label>

    <div class="modal-actions">
      <button onclick="submitThemLop()">‚úÖ L∆∞u</button>
      <button onclick="closeThemLop()">‚ùå Hu·ª∑</button>
    </div>
  </div>
</div>


<!-- Form S·ª≠a l·ªõp -->
<div id="suaLopModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>‚úèÔ∏è S·ª≠a th√¥ng tin l·ªõp</h3>

    <label>Ch·ªçn l·ªõp:
      <select id="edit-class-select" onchange="loadLopInfoToForm()"></select>
    </label>

    <label>T√™n l·ªõp:
      <input type="text" id="edit-ten" />
    </label>

    <label>Ng√†y b·∫Øt ƒë·∫ßu:
      <input type="date" id="edit-ngay" />
    </label>

    <label>H·ªçc ph√≠ m·ªói bu·ªïi:
      <input type="number" id="edit-hocphi" />
    </label>

    <label>Th·ªùi gian h·ªçc:
      <input type="text" id="edit-thoigian" />
    </label>

    <label>ƒê·ªãa ƒëi·ªÉm:
      <input type="text" id="edit-diadiem" />
    </label>

    <div class="modal-actions">
      <button onclick="submitSuaLop()">‚úÖ C·∫≠p nh·∫≠t</button>
      <button onclick="closeSuaLop()">‚ùå Hu·ª∑</button>
    </div>
  </div>
</div>



<!-- Form Xo√° l·ªõp -->
<div id="xoaLopModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>üóë Xo√° l·ªõp</h3>

    <label>Ch·ªçn l·ªõp c·∫ßn xo√°:
      <select id="xoa-class-select" onchange="switchTab(this.value)"></select>
    </label>

    <div class="modal-actions">
      <button onclick="submitXoaLop()">üóë Xo√°</button>
      <button onclick="closeXoaLop()">‚ùå Hu·ª∑</button>
    </div>
  </div>
</div>


<!-- Form Th√™m h·ªçc sinh -->
<div id="themHsModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>‚ûï Th√™m h·ªçc sinh</h3>

    <label>Ch·ªçn l·ªõp:
      <select id="hs-class-select" onchange="onChangeClassInThemHs()"></select>
    </label>

    <label>H·ªç v√† t√™n h·ªçc sinh:
      <input type="text" id="hs-ten" placeholder="Nguy·ªÖn VƒÉn A" />
    </label>

    <div class="modal-actions">
      <button onclick="submitThemHs()">‚úÖ L∆∞u</button>
      <button onclick="closeThemHs()">‚ùå Hu·ª∑</button>
    </div>
  </div>
</div>


<!-- Form S·ª≠a h·ªçc sinh -->
<div id="suaHsModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>‚úèÔ∏è S·ª≠a h·ªçc sinh</h3>

    <label>Ch·ªçn l·ªõp:
      <select id="edit-hs-class" onchange="loadStudentsForEdit(); onChangeClassInSuaHs();"></select>
    </label>

    <label>Ch·ªçn h·ªçc sinh:
      <select id="edit-hs-select" onchange="fillOldStudentName()"></select>
    </label>

    <label>T√™n m·ªõi:
      <input type="text" id="edit-hs-name" placeholder="Nh·∫≠p t√™n m·ªõi..." />
    </label>

    <div class="modal-actions">
      <button onclick="submitSuaHs()">‚úÖ C·∫≠p nh·∫≠t</button>
      <button onclick="closeSuaHs()">‚ùå Hu·ª∑</button>
    </div>
  </div>
</div>


<!-- Form Xo√° h·ªçc sinh -->
<div id="xoaHsModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>üóë Xo√° h·ªçc sinh</h3>

    <label>Ch·ªçn l·ªõp:
      <select id="xoa-hs-class" onchange="loadStudentsForXoa(); onChangeClassInXoaHs();"></select>
    </label>

    <label>Ch·ªçn h·ªçc sinh:
      <select id="xoa-hs-select"></select>
    </label>

    <div class="modal-actions">
      <button onclick="submitXoaHs()">üóë Xo√°</button>
      <button onclick="closeXoaHs()">‚ùå Hu·ª∑</button>
    </div>
  </div>
</div>


<!-- Form S·ª≠a ng√†y ƒëi·ªÉm danh -->
<div id="suaNgayModal" class="modal-overlay" style="display: none;">
  <div class="modal-content">
    <h3>‚úèÔ∏è S·ª≠a ng√†y ƒëi·ªÉm danh</h3>

    <label>Ch·ªçn l·ªõp:
      <select id="sua-ngay-class" onchange="loadDatesForClass()"></select>
    </label>

    <label>Ch·ªçn ng√†y c·∫ßn s·ª≠a:
      <select id="sua-ngay-cu"></select>
    </label>

    <label>Ng√†y m·ªõi:
      <input type="date" id="sua-ngay-moi" />
    </label>

    <div class="modal-actions">
      <button onclick="submitSuaNgay()">‚úèÔ∏è S·ª≠a</button>
      <button onclick="submitXoaNgay()">üóë Xo√°</button>
      <button onclick="closeSuaNgay()">‚ùå Hu·ª∑</button>
    </div>
  </div>
</div>

<!-- Khung theo d√µi thu h·ªçc ph√≠ -->
<div id="hophithongke" style="margin-top: 20px; padding: 12px; border-top: 1px solid #ccc;">
  <h3>üìä Theo d√µi h·ªçc ph√≠</h3>
  <div style="display: flex; gap: 16px; flex-direction: column; max-width: 300px;">
    <button id="btn-dathu" style="text-align: left; padding: 10px;">
      ‚úÖ ƒê√£ thu: <span id="count-dathu">0</span> h·ªçc sinh ‚Äì <span id="sum-dathu">0 ƒë</span>
    </button>
    <button id="btn-chuathu" style="text-align: left; padding: 10px;">
      ‚ùå Ch∆∞a thu: <span id="count-chuathu">0</span> h·ªçc sinh ‚Äì <span id="sum-chuathu">0 ƒë</span>
    </button>

    <!-- ‚úÖ Th√™m thanh ti·∫øn tr√¨nh -->
    <div style="margin-top: 10px;">
      <div style="font-size: 14px;">üìà T·ª∑ l·ªá thu h·ªçc ph√≠: <span id="progress-percent">0%</span></div>
      <div style="background: #eee; border-radius: 6px; overflow: hidden; height: 14px; margin-top: 4px;">
        <div id="progress-bar" style="background: #4caf50; width: 0%; height: 100%; transition: width 0.5s;"></div>
      </div>
    </div>
  </div>
</div>


</body>
</html>
